define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){var e=function(b,c,d,e){this._region=a(b),this._visioid=c,this._presentStr=d,this._missingStr=e,this._presence=[],this._checkboxes=a(b).find("tbody").find("tr").find('[data-element="visio-checkbox"]'),this._checkboxes.on("click",this._toggleUserPresence.bind(this)),this._getUsersPresence()};return e.prototype._getUsersPresence=function(){b.call([{methodname:"mod_visio_get_presence",args:{visioid:this._visioid},done:function(a){this._presence=a,this._setPresenceInTable()}.bind(this),fail:c.exception}])},e.prototype._setPresenceInTable=function(){var a=this._region.find("tbody").find("tr");this._presence.forEach(function(b){var c=a.find('[data-element="visio-checkbox"][value='+b.userid+"]");c&&1==b.value?c.prop("indeterminate",!0):c&&2==b.value?c.prop("checked",!0):c.prop("checked",!1)})},e.prototype._toggleUserPresence=function(b){var c=b.currentTarget,d=a(c).val();if(d){var e=this._region.find('[data-element="visio-firstname"][value='+d+"]").text(),f=this._region.find('[data-element="visio-lastname"][value='+d+"]").text(),g=e+" "+f;this._attestUserPresence(d,a(c).prop("checked"),g)}},e.prototype._attestUserPresence=function(a,e,f){var g={name:f,status:1==e?this._presentStr:this._missingStr};b.call([{methodname:"mod_visio_set_presence",args:{visioid:this._visioid,userid:a,value:1==e?2:0},done:function(){d.get_string("presence_updated","visio",g).done(function(a){c.addNotification({message:a,type:"success"})})},fail:c.exception}])},e});